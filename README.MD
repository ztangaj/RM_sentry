### DJI RoboMaster 2018 Development Board Type.A Embedded System Code by HKUST Team "ENTERPRIZE"

## Getting Started
### Building & Uploading
**Robot specific codes are placed under src/[robot name]**
* Run `make [robot name]` in the root folder to compile, `[robot name]` should be same as the directory name containing robot specific code.
* If openocd and drivers are well configured, run `make [robot name] upload=st` to upload with st-link or `make [robot name] upload=jlink` to upload with j-link.
* Compile configuration are in `Makefile` for compiling common codes and `./src/(robot)/robot.mk` are for specific robots. By default every file with `.c .cpp` as suffix under the `src/[robot]` folder will be compiled.

### Programming references
* Related documents and datasheets are placed inside ./doc .

### Programming Style and Structure
Visual Studio Code is the recommended editor as this repository comes with relavent configurations. Use its default c/c++ code formatter.

There are two folders inside ./src, "ext_hw" and "periphrials" which are meant for placing dedicated code, see readme.md files there.

For developing on specific robot, please **put all robot specific code inside the subfolder of src with the robot's name (e.g. src/engineer, also define and declare all initiallization of peripherals inside peripherals.cpp peripherals.hpp respectively**.  

**All pin configurations are pre-configured in [robot name]/board/board.h, and should only be generated by [robot name]/board/cfg/board.chcfg, to do that, install and run `fmpp` inside board/cfg**


These are to prevent conflict in peripherals' usage. Developers should check whether the peripheral is already used in an incompetable way.

## Pending Tasks: Listed on clickup

### This system uses ChibiOS 18.2 and CMSIS 5, changes done to these libraries should be stated here:

1. the `ftoa` function from `chibios/hal/lib/streams/chprintf.c` which converts double to string is made usable from other parts of the program.

## Known issues

1. chprintf does not work with float outside main thread, probably due to bugs on varargs, to be investigated
